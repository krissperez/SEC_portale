{% extends 'base.html.twig' %}

{% block body %}
    <h1>Nuovo Cliente</h1>
    <h6>Compilare il form seguente per aggiungere un nuovo cliente</h6>

    <div class="container">
        <form id="formDati" method="post">
            <div class="form-group row">
                <div class="col-md-4 mt-3">
                    <input type="text" class="form-control" id="ragione-sociale" placeholder="Ragione Sociale">
                </div>
                <div class="col-md-4 mt-3">
                    <input type="text" class="form-control" id="partita-iva" placeholder="Partita IVA">
                </div>
                <div class="col-md-4 mt-3">
                    <input type="text" class="form-control" id="settore-attivita" placeholder="Settore AttivitÃ ">
                </div>
            </div>

            <div class="form-group row">
                <div class="col-md-4 mt-3">
                    <input type="text" class="form-control" id="indirizzo" placeholder="Indirizzo">
                </div>
                <div class="col-md-4 mt-3">
                    <input type="text" class="form-control" id="provincia" placeholder="Provincia">
                </div>
                <div class="col-md-4 mt-3">
                    <input type="text" class="form-control" id="cap" placeholder="CAP">
                </div>
            </div>

            <div class="form-group row">
                <div class="col-md-4 mt-3">
                    <input type="email" class="form-control" id="email" placeholder="Email">
                </div>
                <div class="col-md-4 mt-3">
                    <input type="email" class="form-control" id="pec" placeholder="PEC">
                </div>
                <div class="col-md-4 mt-3">
                    <input type="tel" class="form-control" id="telefono" placeholder="Telefono">
                </div>
            </div>


            <div class="form-group row">
                <div class="col-md-6 mt-3">
                    <select class="form-control" id="agente-assegnato">
                        <option>Seleziona un agente</option>
                    </select>
                </div>
                <div class="col-md-6 mt-3">
                    <input type="date" class="form-control" id="data-acquisizione">
                </div>
            </div>

            <div class="col-md-12 mt-4 mb-5">
                <input type="button" id="submit" class="btn btn-primary btn-block w-100"
                       value="Salva">
            </div>
        </form>
    </div>

    <script>
        $(function () {
            user.init();
        })

        let user = {
            init: function (){
                user.setOnClickButton();
            },

            setOnClickButton: function (){
                $('#submit').on('click', function (){
                    window.location.pathname = '/clienti';
                })

                $('#cap').on('change', function (){
                    let inputCap = $('#cap').val();
                    console.log(inputCap);

                    $.ajax({
                        url: 'http://localhost:8080/api/agentsCap/agentsByCap/' + inputCap,
                        type: 'GET',
                        dataType: 'json',

                        success: function (data) {
                            if(data.ok) {
                                console.log(data.ok, data.message, data.data);
                                let agentSelect = $('#agente-assegnato');
                                agentSelect.empty();
                                agentSelect.append('<option>Seleziona un agente</option>'); // Aggiungi l'opzione di default

                                $.each(data.data, function (index, agente) {
                                let option = $('<option></option>').attr('value', agente.id).text(agente.nome + ' ' + agente.cognome); // Usa i campi appropriati
                                agentSelect.append(option);
                                });
                            }
                        },
                        error: function (xhr, status, error) {
                            //let errorJson = JSON.parse(xhr.responseText);
                            console.error('AJAX Error:', xhr.responseText);
                            console.error('Status:', status);
                            console.error('Error:', error);
                            //alert(errorJson.error);
                        }
                    })
                })
            }
        }
    </script>
{% endblock %}

